<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Project 1</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style>
      body {
        font: 10px sans-serif;
      }

      svg {
        padding: 10px 0 0 10px;
        z-index: 0;
      }

      .arc {
        stroke: #fff;
      }
      div.tooltip {
        position: absolute;
        text-align: left;
        width: 200px;
        padding: 20px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
        z-index: 1;
      }
    </style>
  </head>

  <body>
    <script>
      var radius = 80,
        padding = 10;

      var color = d3.scale
        .ordinal()
        .range([
          "#98abc5",
          "#8a89a6",
          "#7b6888",
          "#6b486b",
          "#a05d56",
          "#d0743c",
          "#ff8c00"
        ]);

      var arc = d3.svg
        .arc()
        .outerRadius(radius)
        .innerRadius(radius - 30);
      var pie = d3.layout
        .pie()
        .sort(null)
        .value(function(d) {
          return d.population;
        });
      // Define the div for the tooltip
      var div = d3
        .select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);
      d3.csv("data.csv", function(error, data) {
        if (error) throw error;

        color.domain(
          d3.keys(data[0]).filter(function(key) {
            return (
              key !== "Timestamp" &&
              key !== "Alias" &&
              key !== "Major" &&
              key !== "Repository" &&
              key !== "Communication" &&
              key !== "Computer" &&
              key !== "Math" &&
              key !== "Interaction" &&
              key !== "Interests"
            );
          })
        );

        data.forEach(function(d) {
          d.ages = color.domain().map(function(name) {
            return { name: name, population: +d[name] };
          });
        });

        var legend = d3
          .select("body")
          .append("svg")
          .attr("class", "legend")
          .attr("width", radius * 2)
          .attr("height", radius * 2)
          .selectAll("g")
          .data(
            color
              .domain()
              .slice()
              .reverse()
          )
          .enter()
          .append("g")

          .attr("transform", function(d, i) {
            return "translate(0," + i * 20 + ")";
          });

        legend
          .append("rect")
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", color);

        legend
          .append("text")
          .attr("x", 24)
          .attr("y", 9)
          .attr("dy", ".35em")

          .text(function(d) {
            return d;
          });

        var svg = d3
          .select("body")
          .selectAll(".pie")
          .data(data)
          .enter()
          .append("svg")

          .attr("class", "pie")

          .attr("width", radius * 2)
          .attr("height", radius * 2)
          .attr("opacity", 0.8)
          .on("mouseover", handleMouseOver)
          .on("mouseout", handleMouseOut)
          .append("g")
          .attr("transform", "translate(" + radius + "," + radius + ")");

        svg
          .selectAll(".arc")
          .data(function(d) {
            return pie(d.ages);
          })
          .enter()
          .append("path")

          .attr("class", "arc")
          .attr("d", arc)
          .style("fill", function(d) {
            return color(d.data.name);
          });

        svg
          .append("text")
          .attr("dy", ".35em")

          .style("text-anchor", "middle")
          .text(function(d) {
            return d.Alias;
          });
        // Create Event Handlers for mouse
        function handleMouseOver(d, i) {
          // Add interactivity
          // Use D3 to select element, change color and size
          div
            .transition()
            .duration(200)
            .style("opacity", 1);
          div
            .html(
              "Collaboration skills: " +
                d.Collaboration +
                "<br/>" +
                "UX skills: " +
                d.UX +
                "<br/>" +
                "Graphic skills: " +
                d.Graphics +
                "<br/>" +
                "Programming skills: " +
                d.Programming +
                "<br/>" +
                "Drawing skills: " +
                d.Drawing +
                "<br/>" +
                "Statistical skills: " +
                d.Statistical +
                "<br/>" +
                "Information visualization skills: " +
                d.IV +
                "<br/><br/>" +
                "Interests: <br/>" +
                d.Interests
            )
            .style("left", d3.event.pageX + "px")
            .style("top", d3.event.pageY + "px");
          d3.select(this).attr({
            fill: "orange",
            opacity: 1
            //r: radius * 2
          });
        }

        function handleMouseOut(d, i) {
          // Use D3 to select element, change color back to normal
          div
            .transition()
            .duration(500)
            .style("opacity", 0);
          d3.select(this).attr({
            fill: "black",
            opacity: 0.8

            //r: radius
          });
        }
      });
    </script>
  </body>
</html>
